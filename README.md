# SkyPlayer

[![](https://jitpack.io/v/zhiwei-wu/SkyPlayer.svg)](https://jitpack.io/#zhiwei-wu/SkyPlayer)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/Platform-Android-green.svg)](https://developer.android.com)
[![API](https://img.shields.io/badge/API-30%2B-brightgreen.svg)](https://android-arsenal.com/api?level=30)

**ä¸€ä¸ªåŸºäº FFmpeg å®˜æ–¹ ffplay æ·±åº¦æ”¹é€ çš„ Android éŸ³è§†é¢‘æ’­æ”¾å™¨**

ä» FFmpeg 8.0 çš„ ffplay æ ¸å¿ƒä»£ç ï¼ˆ126KBï¼‰æ”¹é€ è€Œæ¥ï¼Œä¿ç•™äº†ç»è¿‡æ•°åå¹´å®æˆ˜éªŒè¯çš„æ’­æ”¾é€»è¾‘ï¼Œé’ˆå¯¹ Android å¹³å°è¿›è¡Œæ·±åº¦ä¼˜åŒ–ã€‚ä¸æ˜¯ç®€å•çš„ FFmpeg å°è£…ï¼Œè€Œæ˜¯**ä»è§£å°è£…ã€è§£ç ã€åŒæ­¥åˆ°æ¸²æŸ“çš„å®Œæ•´å®ç°ï¼Œæ·±å…¥å­¦ä¹ éŸ³è§†é¢‘å¼€å‘çš„æœ€ä½³å®è·µ**ã€‚

## ğŸŒŸ é¡¹ç›®ç‰¹ç‚¹

#### 1. åŸºäº ffplay æ ¸å¿ƒæ”¹é€ 
- **FFmpeg 8.0**ï¼šä½¿ç”¨ FFmpeg æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œè·å¾—æœ€æ–°çš„æ ¼å¼æ”¯æŒå’Œæ€§èƒ½ä¼˜åŒ–
- **ä¿ç•™ç»å…¸æ¶æ„**ï¼šå®Œæ•´ä¿ç•™ 126KB çš„ `ffplay.c` æ’­æ”¾å¼•æ“
- **ç»è¿‡éªŒè¯çš„ç¨³å®šæ€§**ï¼šffplay ä½œä¸º FFmpeg å®˜æ–¹æ’­æ”¾å™¨ç¤ºä¾‹ï¼Œç»è¿‡æ•°åå¹´å®æˆ˜éªŒè¯
- **å®Œæ•´çš„æ’­æ”¾æµç¨‹**ï¼šä»è§£å°è£…ã€è§£ç ã€éŸ³ç”»åŒæ­¥åˆ°æ¸²æŸ“çš„å…¨é“¾è·¯å®ç°

#### 2. é’ˆå¯¹ Android å¹³å°æ·±åº¦ä¼˜åŒ–
- **OpenGL ES 2.0 æ¸²æŸ“**ï¼š5 ç§ç‹¬ç«‹ä¼˜åŒ–çš„æ¸²æŸ“å™¨ï¼Œæ”¯æŒ YUV420P/422Pã€NV12/21ã€RGBA
- **OpenSL ES éŸ³é¢‘**ï¼šè¶…ä½å»¶è¿ŸéŸ³é¢‘è¾“å‡ºï¼ˆ< 20msï¼‰ï¼Œè¿œä¼˜äº AudioTrack
- **å®‰å…¨çš„ JNI è®¾è®¡**ï¼šçº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆTLSï¼‰ã€è‡ªåŠ¨ attach/detachã€å¼±å¼•ç”¨é˜²æ³„æ¼ï¼Œé¿å…å¸¸è§çš„ JNI å†…å­˜æ³„æ¼å’Œå´©æºƒé—®é¢˜

#### 3. å·¥ç¨‹åŒ–è®¾è®¡
- **çº¿ç¨‹å®‰å…¨**ï¼šå®Œæ•´çš„å¤šçº¿ç¨‹å®‰å…¨è®¾è®¡å’Œå†…å­˜ç®¡ç†ï¼Œé¿å…å¹¶å‘é—®é¢˜
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œèµ„æºé‡Šæ”¾æœºåˆ¶ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šå¼‚æ­¥äº‹ä»¶å¤„ç†ï¼Œè§£è€¦æ’­æ”¾æ§åˆ¶å’ŒçŠ¶æ€é€šçŸ¥
- **RAII æœºåˆ¶**ï¼šä½¿ç”¨ç°ä»£ C++ çš„ RAII æ¨¡å¼ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ

#### 4. æ¸…æ™°çš„æ¶æ„è®¾è®¡
- **åˆ†å±‚æ¶æ„**ï¼šJavaã€JNIã€Nativeã€FFmpeg å››å±‚æ¸…æ™°åˆ†ç¦»
- **C/C++ æ··åˆç¼–ç¨‹**ï¼šä½¿ç”¨ç°ä»£ C++ å°è£… C è¯­è¨€çš„ ffplay.cï¼Œè§£å†³ Câ†’C++ å’Œ C++â†’C çš„åŒå‘è°ƒç”¨é—®é¢˜ï¼Œå®ç°è°ƒç”¨éš”ç¦»å’Œæ‰©å±•æ€§
- **JNI å®‰å…¨æ€§**ï¼šå®Œæ•´çš„çº¿ç¨‹å®‰å…¨æœºåˆ¶ï¼Œé¿å…å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å´©æºƒå’Œå†…å­˜æ³„æ¼
- **æ˜“äºç†è§£**ï¼šæ¯ä¸ªæ¨¡å—èŒè´£æ˜ç¡®ï¼Œä»£ç æ³¨é‡Šå®Œæ•´
- **ä¾¿äºæ‰©å±•**ï¼šåŸºäºæ¥å£è®¾è®¡ï¼Œæ”¯æŒè‡ªå®šä¹‰æ¸²æŸ“å™¨å’ŒéŸ³é¢‘è¾“å‡º

#### 5. ä¼˜ç§€çš„å­¦ä¹ ä»·å€¼
- **å®Œæ•´çš„æŠ€æœ¯æ ˆ**ï¼šæ¶µç›– FFmpegã€JNIã€OpenGL ESã€OpenSL ES
- **å¯è¿è¡Œçš„ç¤ºä¾‹**ï¼šapp æ¨¡å—æä¾›å®Œæ•´çš„ Demo
- **æ•™å­¦çº§ä»£ç **ï¼šé€‚åˆå­¦ä¹ éŸ³è§†é¢‘å¼€å‘çš„å®Œæ•´å®ç°

ç›®å‰å·²æ”¯æŒæœ¬åœ°æ–‡ä»¶æ’­æ”¾å’Œåœ¨çº¿è§†é¢‘æ’­æ”¾ï¼ˆHTTP/HTTPS/HLSï¼‰ï¼Œç›´æ’­ç­‰åŠŸèƒ½æŒç»­è¿­ä»£ä¸­ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

SkyPlayer é‡‡ç”¨æ¸…æ™°çš„åˆ†å±‚æ¶æ„è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Java/Kotlin Layer           â”‚
â”‚    (SkyMediaPlayer, IMediaPlayer)   â”‚
â”‚    - æ¥å£è®¾è®¡ï¼šå…¼å®¹ MediaPlayer API â”‚
â”‚    - äº‹ä»¶å¤„ç†ï¼šMediaEventHandler    â”‚
â”‚    - ç”Ÿå‘½å‘¨æœŸç®¡ç†                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ JNI (12 ä¸ªæ–¹æ³•)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           JNI Layer                 â”‚
â”‚  (skymediaplayer_jni.cpp)          â”‚
â”‚  - æ–¹æ³•æ³¨å†Œï¼šJNI_OnLoad             â”‚
â”‚  - çº¿ç¨‹å®‰å…¨ï¼šTLS ç®¡ç† JNIEnv        â”‚
â”‚  - å¯¹è±¡ç®¡ç†ï¼šå¼±å…¨å±€å¼•ç”¨              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Native Layer                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   æ’­æ”¾å™¨æ ¸å¿ƒ                 â”‚   â”‚
â”‚  â”‚   (skymediaplayer.cpp)      â”‚   â”‚
â”‚  â”‚   - å°è£… ffplay             â”‚   â”‚
â”‚  â”‚   - æ’­æ”¾æ§åˆ¶                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   æ¸²æŸ“å™¨ (skyrenderer.cpp)  â”‚   â”‚
â”‚  â”‚   + 5 ä¸ª EGL2 æ¸²æŸ“å™¨         â”‚   â”‚
â”‚  â”‚   - ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   éŸ³é¢‘è¾“å‡º (skyaudio.cpp)   â”‚   â”‚
â”‚  â”‚   - OpenSL ES ä½å»¶è¿Ÿ         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   æ¶ˆæ¯é˜Ÿåˆ—                   â”‚   â”‚
â”‚  â”‚   (sky_msg_queue.cpp)       â”‚   â”‚
â”‚  â”‚   - å¼‚æ­¥äº‹ä»¶å¤„ç†             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         FFmpeg Layer                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   ffplay æ ¸å¿ƒ (ffplay.c)    â”‚   â”‚
â”‚  â”‚   - å®Œæ•´çš„æ’­æ”¾å¼•æ“           â”‚   â”‚
â”‚  â”‚   - éŸ³è§†é¢‘åŒæ­¥               â”‚   â”‚
â”‚  â”‚   - æ™ºèƒ½å¸§ä¸¢å¼ƒ               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   å‘½ä»¤è¡Œå·¥å…·                 â”‚   â”‚
â”‚  â”‚   (cmdutils.c, opt_common.c)â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æ¨¡å—è¯´æ˜

#### Java å±‚ï¼ˆ`SkyMediaPlayer.kt`ï¼‰
- **æ¥å£è®¾è®¡**ï¼šå®ç° `IMediaPlayer` æ¥å£ï¼Œå…¼å®¹ Android MediaPlayer API
- **äº‹ä»¶å¤„ç†**ï¼š`MediaEventHandler` å¤„ç† Native å±‚å›è°ƒ
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šæ­£ç¡®å¤„ç† Surfaceã€ç›‘å¬å™¨ç­‰èµ„æº

#### JNI å±‚ï¼ˆ`skymediaplayer_jni.cpp`ï¼‰
- **æ–¹æ³•æ³¨å†Œ**ï¼š`JNI_OnLoad` ä¸­æ³¨å†Œ 12 ä¸ª Native æ–¹æ³•
- **çº¿ç¨‹å®‰å…¨**ï¼šTLS ç®¡ç† JNIEnvï¼Œè‡ªåŠ¨ attach/detach
- **å¯¹è±¡ç®¡ç†**ï¼šå¼±å…¨å±€å¼•ç”¨é˜²æ­¢æ³„æ¼

#### Native å±‚
- **æ’­æ”¾å™¨æ ¸å¿ƒ**ï¼ˆ`skymediaplayer.cpp`ï¼‰ï¼šå°è£… ffplayï¼Œæä¾›æ’­æ”¾æ§åˆ¶
- **æ¸²æŸ“å™¨**ï¼ˆ`skyrenderer.cpp` + 5 ä¸ª EGL2 æ¸²æŸ“å™¨ï¼‰ï¼šç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“
- **éŸ³é¢‘è¾“å‡º**ï¼ˆ`skyaudio.cpp`ï¼‰ï¼šOpenSL ES ä½å»¶è¿Ÿæ’­æ”¾
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼ˆ`sky_msg_queue.cpp`ï¼‰ï¼šå¼‚æ­¥äº‹ä»¶å¤„ç†

#### FFmpeg å±‚
- **ffplay æ ¸å¿ƒ**ï¼ˆ`ffplay.c`ï¼‰ï¼šå®Œæ•´çš„æ’­æ”¾å¼•æ“
- **å‘½ä»¤è¡Œå·¥å…·**ï¼ˆ`cmdutils.c`ã€`opt_common.c`ï¼‰ï¼šå‚æ•°è§£æå’Œé…ç½®
- **é€‚é…å±‚**ï¼ˆ`sky_ffplay.c/h`ï¼‰ï¼šAndroid å¹³å°é€‚é…

## ğŸ¬ æ”¯æŒçš„æ ¼å¼å’Œåè®®

### è§†é¢‘æ ¼å¼
- **å®¹å™¨æ ¼å¼**ï¼šMP4ã€AVIã€MKVã€WebMã€MOV
- **è§†é¢‘ç¼–ç **ï¼šH.264ã€H.265/HEVCã€MPEG-4ã€MPEG-2ã€VP8ã€VP9

### éŸ³é¢‘æ ¼å¼
- **éŸ³é¢‘ç¼–ç **ï¼šAACã€MP3ã€Opusã€Vorbis

### ç½‘ç»œåè®®
- **HTTP/HTTPS**ï¼šæ ‡å‡† HTTP(S) è§†é¢‘æµ
- **HLS (m3u8)**ï¼šApple HTTP Live Streamingï¼Œæ”¯æŒè‡ªé€‚åº”ç ç‡
- **æœ¬åœ°æ–‡ä»¶**ï¼šæ”¯æŒæœ¬åœ°å­˜å‚¨çš„æ‰€æœ‰æ”¯æŒæ ¼å¼

### æŠ€æœ¯ç‰¹æ€§
- âœ… **OpenSSL é›†æˆ**ï¼šæ”¯æŒ HTTPS åŠ å¯†ä¼ è¾“
- âœ… **HLS è‡ªé€‚åº”ç ç‡**ï¼šæ ¹æ®ç½‘ç»œçŠ¶å†µè‡ªåŠ¨åˆ‡æ¢æ¸…æ™°åº¦
- âœ… **ç½‘ç»œæµç¼“å†²**ï¼šæ™ºèƒ½ç¼“å†²ç­–ç•¥ï¼Œæµç•…æ’­æ”¾
- âœ… **æ–­ç‚¹ç»­æ’­**ï¼šæ”¯æŒ Seek åˆ°ä»»æ„ä½ç½®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ¬åœ°è§†é¢‘æ’­æ”¾

```kotlin
import imt.zw.skymediaplayer.player.SkyMediaPlayer

class MainActivity : AppCompatActivity() {
    private lateinit var player: SkyMediaPlayer
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        
        // åˆ›å»ºæ’­æ”¾å™¨å®ä¾‹
        player = SkyMediaPlayer()
        
        // è®¾ç½®æœ¬åœ°è§†é¢‘è·¯å¾„
        player.setDataSource("/sdcard/Movies/video.mp4")
        
        // è®¾ç½®æ¸²æŸ“ Surface
        player.setSurface(surfaceView.holder.surface)
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬
        player.setOnPreparedListener {
            // å‡†å¤‡å®Œæˆï¼Œå¼€å§‹æ’­æ”¾
            player.start()
        }
        
        player.setOnErrorListener { _: IMediaPlayer, what: Int, extra: Int ->
            Log.e("Player", "Error: what=$what, extra=$extra")
            true
        }
        
        // å¼‚æ­¥å‡†å¤‡
        player.prepareAsync()
    }
    
    override fun onDestroy() {
        super.onDestroy()
        player.release()
    }
}
```

### åœ¨çº¿è§†é¢‘æ’­æ”¾

```kotlin
// HTTP/HTTPS è§†é¢‘
player.setDataSource("https://example.com/video.mp4")

// HLS ç›´æ’­æµ
player.setDataSource("https://example.com/live/stream.m3u8")

// è®¾ç½®å…¶ä»–å‚æ•°ä¸æœ¬åœ°æ’­æ”¾ç›¸åŒ
player.setSurface(surfaceView.holder.surface)
player.setOnPreparedListener {
    player.start()
}
player.prepareAsync()
```

### æ’­æ”¾æ§åˆ¶

```kotlin
// æ’­æ”¾
player.start()

// æš‚åœ
player.pause()

// åœæ­¢
player.stop()

// è·³è½¬åˆ°æŒ‡å®šä½ç½®ï¼ˆæ¯«ç§’ï¼‰
player.seekTo(30000) // è·³è½¬åˆ° 30 ç§’

// è·å–å½“å‰æ’­æ”¾ä½ç½®
val position = player.currentPosition

// è·å–è§†é¢‘æ€»æ—¶é•¿
val duration = player.duration

// è®¾ç½®éŸ³é‡ï¼ˆ0.0 - 1.0ï¼‰
player.setVolume(0.5f, 0.5f)

// é™éŸ³
player.setMute(true)
```

### äº‹ä»¶ç›‘å¬

```kotlin
// å‡†å¤‡å®Œæˆç›‘å¬
player.setOnPreparedListener {
    Log.d("Player", "å‡†å¤‡å®Œæˆ")
}

// æ’­æ”¾å®Œæˆç›‘å¬
player.setOnCompletionListener {
    Log.d("Player", "æ’­æ”¾å®Œæˆ")
}

// é”™è¯¯ç›‘å¬
player.setOnErrorListener { _: IMediaPlayer, what: Int, extra: Int ->
    Log.e("Player", "æ’­æ”¾é”™è¯¯: what=$what, extra=$extra")
    true // è¿”å› true è¡¨ç¤ºå·²å¤„ç†é”™è¯¯
}

// ç¼“å†²æ›´æ–°ç›‘å¬
player.setOnBufferingUpdateListener { mp: IMediaPlayer, percent: Int ->
    Log.d("Player", "ç¼“å†²è¿›åº¦: $percent%")
}

// Seek å®Œæˆç›‘å¬
player.setOnSeekCompleteListener {
    Log.d("Player", "Seek å®Œæˆ")
}
```

## ğŸ”§ ç¼–è¯‘è¯´æ˜

### ç¯å¢ƒè¦æ±‚

- Android Studio Arctic Fox æˆ–æ›´é«˜ç‰ˆæœ¬
- NDK 21.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- CMake 3.22.1 æˆ–æ›´é«˜ç‰ˆæœ¬
- Gradle 8.0 æˆ–æ›´é«˜ç‰ˆæœ¬

### ç¼–è¯‘æ­¥éª¤

1. å…‹éš†ä»“åº“
```bash
git clone https://github.com/zhiwei-wu/SkyPlayer.git
cd SkyPlayer
```

2. æ‰“å¼€é¡¹ç›®
ä½¿ç”¨ Android Studio æ‰“å¼€é¡¹ç›®

3. ç¼–è¯‘ aarï¼Œé›†æˆåˆ°ä½ çš„é¡¹ç›®
```bash
./gradlew :skymediaplayer:assembleRelease
```

### FFmpeg ç¼–è¯‘é…ç½®

æœ¬é¡¹ç›®ä½¿ç”¨å®šåˆ¶ç¼–è¯‘çš„ FFmpegï¼Œæ”¯æŒä»¥ä¸‹ç‰¹æ€§ï¼š

#### ç½‘ç»œæ”¯æŒ
- **OpenSSL é›†æˆ**ï¼šæ”¯æŒ HTTPS åŠ å¯†ä¼ è¾“
- **ç½‘ç»œåè®®**ï¼šHTTPã€HTTPSã€TCPã€UDPã€RTPã€RTSPã€HLS
- **æµåª’ä½“æ ¼å¼**ï¼šHLS (m3u8)ã€MPEG-TS

#### ç¼–è¯‘é…ç½®è¦ç‚¹

```bash
# å¯ç”¨ç½‘ç»œæ”¯æŒ
--enable-network

# å¯ç”¨ OpenSSLï¼ˆHTTPS æ”¯æŒï¼‰
--enable-openssl

# æ”¯æŒçš„è§£å°è£…å™¨
--enable-demuxer=mov,mp4,avi,matroska,webm,hls,mpegts

# æ”¯æŒçš„ç½‘ç»œåè®®
--enable-protocol=file,http,https,tcp,udp,rtp,rtsp,hls

# OpenSSL é“¾æ¥
--extra-cflags="-I$OPENSSL_DIR/include"
--extra-ldflags="-L$OPENSSL_DIR/lib"
# é™æ€é“¾æ¥ libssl.a å’Œ libcrypto.a
```

è¯¦ç»†çš„ç¼–è¯‘è„šæœ¬è¯·å‚è€ƒï¼š[build_skyplayer_ffmpeg.sh](https://github.com/zhiwei-wu/FFmpeg/blob/main/build_skyplayer_ffmpeg.sh)

#### å…³é”®é…ç½®å˜æ›´

**æäº¤**: `f1b2f39` - æ”¯æŒ http,https,hls åè®®

ä¸»è¦å˜æ›´ï¼š
1. **å¯ç”¨ç½‘ç»œæ”¯æŒ**ï¼š`--enable-network`
2. **é›†æˆ OpenSSL**ï¼š`--enable-openssl`
3. **æ–°å¢ HLS æ”¯æŒ**ï¼š`--enable-demuxer=hls,mpegts`
4. **æ‰©å±•ç½‘ç»œåè®®**ï¼š`--enable-protocol=http,https,tcp,udp,rtp,rtsp,hls`
5. **é“¾æ¥ OpenSSL åº“**ï¼šé™æ€é“¾æ¥ `libssl.a` å’Œ `libcrypto.a`

## ğŸ“± ç¤ºä¾‹åº”ç”¨

é¡¹ç›®åŒ…å«ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹åº”ç”¨ï¼ˆ`app` æ¨¡å—ï¼‰ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ SkyPlayerï¼š

- åŸºæœ¬æ’­æ”¾åŠŸèƒ½
- æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾ã€æš‚åœã€åœæ­¢ã€Seekï¼‰
- æ’­æ”¾çŠ¶æ€æ˜¾ç¤º
- é”™è¯¯å¤„ç†

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ‘¨â€ğŸ’» ä½œè€…

**Wu Zhiwei**
- GitHub: [@zhiwei-wu](https://github.com/zhiwei-wu)
- Email: zhiwei.wu@foxmail.com

## ğŸ¯ è·¯çº¿å›¾

### å·²å®Œæˆ âœ…
- [x] åŸºäº ffplay çš„æ ¸å¿ƒæ’­æ”¾å¼•æ“
- [x] 5 ç§åƒç´ æ ¼å¼çš„ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“
- [x] OpenSL ES ä½å»¶è¿ŸéŸ³é¢‘è¾“å‡º
- [x] å®Œæ•´çš„ JNI çº¿ç¨‹å®‰å…¨è®¾è®¡
- [x] æœ¬åœ°æ–‡ä»¶æ’­æ”¾æ”¯æŒ
- [x] æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾ã€æš‚åœã€Seekï¼‰
- [x] äº‹ä»¶å›è°ƒæœºåˆ¶
- [x] **åœ¨çº¿è§†é¢‘æ’­æ”¾ï¼ˆHTTP/HTTPSï¼‰** ğŸ‰
- [x] **HLS ç›´æ’­æµæ”¯æŒï¼ˆm3u8ï¼‰** ğŸ‰
- [x] **OpenSSL é›†æˆï¼ˆHTTPS åŠ å¯†ä¼ è¾“ï¼‰** ğŸ‰

### è¿›è¡Œä¸­ ğŸš§
- [ ] RTMP ç›´æ’­æµæ”¯æŒ
- [ ] å­—å¹•æ”¯æŒ
- [ ] æ’­æ”¾åˆ—è¡¨ç®¡ç†
- [ ] ç½‘ç»œçŠ¶æ€ç›‘æ§å’Œè‡ªé€‚åº”

### è®¡åˆ’ä¸­ ğŸ“‹
- [ ] ç¡¬ä»¶è§£ç æ”¯æŒï¼ˆMediaCodecï¼‰
- [ ] å€é€Ÿæ’­æ”¾
- [ ] æˆªå›¾åŠŸèƒ½
- [ ] è§†é¢‘å½•åˆ¶
- [ ] æ›´å¤šéŸ³è§†é¢‘æ ¼å¼æ”¯æŒ
- [ ] RTSP æµæ”¯æŒ

## ğŸ™ è‡´è°¢

- [FFmpeg](https://ffmpeg.org/) - å¼ºå¤§çš„å¤šåª’ä½“å¤„ç†åº“
- [ffplay](https://ffmpeg.org/ffplay.html) - FFmpeg çš„æ’­æ”¾å™¨ç¤ºä¾‹ï¼Œæœ¬é¡¹ç›®çš„æ ¸å¿ƒåŸºç¡€
- [ijkplayer](https://github.com/bilibili/ijkplayer) - Bilibili å¼€æºçš„åŸºäº FFmpeg çš„æ’­æ”¾å™¨ï¼Œæä¾›äº†é‡è¦çš„å®ç°å‚è€ƒ
- [SDL](https://www.libsdl.org/) - Simple DirectMedia Layerï¼Œffplay çš„åŸå§‹æ¸²æŸ“å±‚

## ğŸŒŸ Star History

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Star â­ï¸

[![Star History Chart](https://api.star-history.com/svg?repos=zhiwei-wu/SkyPlayer&type=Date)](https://star-history.com/#zhiwei-wu/SkyPlayer&Date)

---

**Made with â¤ï¸ by Wu Zhiwei**
